{% extends 'user/master.twig' %}
{% block content %}
    <!--  BEGIN CONTENT AREA  -->
    <div id="content" class="main-content">
        <div class="layout-px-spacing">

            <div class="middle-content container-xxl p-0">
                <div id="call-ringing"></div>

                <!-- BREADCRUMB -->
                <div class="page-meta">
                    <nav class="breadcrumb-style-one" aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="#">Users</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Account Settings</li>
                        </ol>
                    </nav>
                </div>
                <!-- /BREADCRUMB -->

                <div class="account-settings-container layout-top-spacing">

                    <div class="account-content">
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <h2>Profile</h2>

                                <ul class="nav nav-pills" id="animateLine" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="animated-underline-home-tab" data-bs-toggle="tab" href="#animated-underline-home" role="tab" aria-controls="animated-underline-home" aria-selected="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg> Basic</button>
                                    </li>
                                    {% if loginType == "firm" %}
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="animated-underline-home-company-tab" data-bs-toggle="tab" href="#animated-underline-home-company" role="tab" aria-controls="animated-underline-home-company" aria-selected="true"><svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg> Company Information</button>
                                    </li>
                                    {% endif %}
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="animated-underline-profile-tab" data-bs-toggle="tab" href="#animated-underline-profile" role="tab" aria-controls="animated-underline-profile" aria-selected="false" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-dollar-sign"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg> Payment Details</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="animated-underline-contact-tab" data-bs-toggle="tab" href="#animated-underline-contact" role="tab" aria-controls="animated-underline-contact" aria-selected="false" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-lock"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg> Security</button>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div class="tab-content" id="animateLineContent-4">

                            <div class="tab-pane fade show active" id="animated-underline-home" role="tabpanel" aria-labelledby="animated-underline-home-tab">
                                <div class="row " >
                                    <div class="col-xl-12 col-lg-12 col-md-12 layout-spacing" id="general_information_reload">
                                        <form class="section general-info" method="post" id="general_information"  enctype="multipart/form-data">
                                            <div class="info">
                                                <h6 class="">General Information</h6>
                                                <div class="row">
                                                    <div class="col-lg-11 mx-auto">
                                                        <div class="row">
                                                            <div class="col-xl-2 col-lg-12 col-md-4">
                                                                <div class="profile-image  mt-4 pe-md-4">
                                                                    <div class="img-uploader-content">
                                                                        <input type="file" class="filepond" name="filepond" accept="image/png, image/jpeg, image/gif"/>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                            <div class="col-xl-12 col-lg-12 col-md-12 mt-md-0 mt-4">
                                                                <div class="form">
                                                                    <div class="row">
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label for="fname">First Name</label>
                                                                                <input type="text" class="form-control mb-3" id="fname" name="fname" placeholder="First Name" >
                                                                                <input type="hidden"  id="id" name="basic_id" value="{{ userinfo[0].id }}">
                                                                                <input type="hidden" name="csrf" value="{{ csrf}}">
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label for="lname">Last Name</label>
                                                                                <input type="text" class="form-control mb-3" id="lname" name="lname" placeholder="Last Name" >
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label for="phone">Phone</label>
                                                                                <input type="text" class="form-control mb-3" id="phone" name="phone" placeholder="Write your phone number here" >
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label for="email">Email</label>
                                                                                <input type="text" class="form-control mb-3" id="email" name="email" placeholder="Write your email here" readonly>
                                                                            </div>
                                                                        </div>


                                                                    </div>
                                                                    <h5 class="">Social</h5>

                                                                    <div class="row">

                                                                        <div class="col-md-12 ">
                                                                            <div class="row">
                                                                                <div class="col-md-6">
                                                                                    <div class="input-group social-linkedin mb-3">
                                                                                        <span class="input-group-text me-3" ><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-linkedin"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></span>
                                                                                        <input type="text" class="form-control" placeholder="Linkedin Username" aria-label="Username" aria-describedby="linkedin" id="linkedin" name="linkedin" value="{{ userinfo[0].linkedin }}">
                                                                                    </div>
                                                                                </div>

                                                                                <div class="col-md-6">
                                                                                    <div class="input-group social-tweet mb-3">
                                                                                        <span class="input-group-text me-3" ><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></span>
                                                                                        <input type="text" class="form-control" placeholder="Twitter Username" aria-label="Username" aria-describedby="tweet" id="tweet" name="tweet" value="{{ userinfo[0].tweet }}">
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-md-12 mx-auto">
                                                                            <div class="row">
                                                                                <div class="col-md-6">
                                                                                    <div class="input-group social-fb mb-3">
                                                                                        <span class="input-group-text me-3" id="fb"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-facebook"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg></span>
                                                                                        <input type="text" class="form-control" placeholder="Facebook Username"  id="facebook" name="facebook" value="{{ userinfo[0].facebook }}">
                                                                                    </div>
                                                                                </div>

                                                                                <div class="col-md-6">
                                                                                    <div class="input-group social-github mb-3">
                                                                                        <span class="input-group-text me-3" ><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></span>
                                                                                        <input type="text" class="form-control" placeholder="Github Username"  id="github" name="github" value="{{ userinfo[0].github }}">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-md-12 mt-1">
                                                                                    <div class="form-group text-end">
                                                                                        <button type="button" class="btn btn-secondary" id="btn" onclick="do_profile()">Save</button>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>

                                </div>
                            </div>

                            {% if loginType == "firm" %}
                            <div class="tab-pane fade" id="animated-underline-home-company" role="tabpanel" aria-labelledby="animated-underline-home-company-tab">
                                <div class="row">
                                    <div class="col-xl-12 col-lg-12 col-md-12 layout-spacing">
                                        <form class="section general-info" method="post" id="company_information"  enctype="multipart/form-data">
                                            <div class="info">
                                                <h6 class="">Company Information</h6>
                                                <div class="row">
                                                    <div class="col-lg-11 mx-auto">
                                                        <div class="row">
                                                            <div class="col-xl-12 col-lg-12 col-md-12 mt-md-0 mt-4">
                                                                <div class="form">
                                                                    <div class="row">
                                                                        <div class="col-xl-2 col-lg-12 col-md-4">
                                                                            <div class="profile-image  mt-4 pe-md-4">
                                                                                <div class="img-uploader-content">
                                                                                    <input type="file" class="filepond1" name="filepond1" accept="image/png, image/jpeg, image/gif"/>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-12">
                                                                            <div class="form-group">
                                                                                <label for="contact_name">Contact Name</label>
                                                                                <input type="text" class="form-control mb-3" id="contact_name" name="contact_name" placeholder="Contact Name" value="{{ userinfo[0].contact_name }}">
                                                                                <input type="hidden"  id="id_company" name="id_company"  value="{{ userinfo[0].id }}">
                                                                                <input type="hidden" name="csrf" value="{{ csrf}}">
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label for="company_name">Company Name</label>
                                                                                <input type="text" class="form-control mb-3" id="company_name" name="company_name" placeholder="Company Name" value="{{ userinfo[0].company_name }}">
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label for="representative_name">Representative name</label>
                                                                                <input type="text" class="form-control mb-3" id="representative_name" name="representative_name" placeholder="Representative name" value="{{ userinfo[0].representative_name }}">
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label for="owner_of_organization">Owner of the Organization</label>
                                                                                <input type="text" class="form-control mb-3" id="owner_of_organization" name="owner_of_organization" placeholder="Owner of the Organization " value="{{ userinfo[0].owner_of_organization }}">
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-12">
                                                                            <div class="form-group">
                                                                                <label for="type_of_organization">Type of Organization</label>
                                                                                <input type="text" class="form-control mb-3" id="type_of_organization" name="type_of_organization" placeholder="Type of Organization" value="{{ userinfo[0].type_of_organization }}">
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-12 mt-1">
                                                                            <div class="form-group text-end">
                                                                                <button type="button" class="btn btn-secondary" id="btn" onclick="do_company_profile()">Save</button>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="col-xl-12 col-lg-12 col-md-12 layout-spacing">
                                        <form class="section general-info" method="post" id="bank_details"  enctype="multipart/form-data">
                                            <div class="info">
                                                <h6 class="">Bank Details</h6>
                                                <div class="row">
                                                    <div class="col-lg-11 mx-auto">
                                                        <div class="row">
                                                            <div class="col-xl-12 col-lg-12 col-md-12 mt-md-0 mt-4">
                                                                <div class="form">
                                                                    <div class="row">
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label for="account_number">Account #</label>
                                                                                <input type="text" class="form-control mb-3" id="account_number" name="account_number" placeholder="Account #" value="{{ userinfo[0].account_number }}">
                                                                                <input type="hidden"  id="id_company" name="id_company_bank"  value="{{ userinfo[0].id }}">
                                                                                <input type="hidden" name="csrf" value="{{ csrf}}">
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label for="bank_name">Bank Name</label>
                                                                                <input type="text" class="form-control mb-3" id="bank_name" name="bank_name" placeholder="Bank Name" value="{{ userinfo[0].bank_name }}">
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label for="swift_code">SWIFT Code</label>
                                                                                <input type="text" class="form-control mb-3" id="swift_code" name="swift_code" placeholder="SWIFT Code" value="{{ userinfo[0].swift_code }}">
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label for="bank_country">Choose Country</label>
                                                                                <select class="form-select" name="bank_country" id="bank_country">
                                                                                    <option selected="">Choose Country</option>
                                                                                    {% for country in countries %}
                                                                                        <option value="{{ country.code }}" {% if userinfo[0].bank_country == country.code %} selected{% endif %}>{{ country.name }}</option>
                                                                                    {% endfor %}
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-12 mt-1">
                                                                            <div class="form-group text-end">
                                                                                <button type="button" class="btn btn-secondary" id="btn" onclick="do_bank_details()">Save</button>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            <div class="tab-pane fade" id="animated-underline-profile" role="tabpanel" aria-labelledby="animated-underline-profile-tab">
                                <div class="row">
                                    <div class="col-xl-6 col-lg-12 col-md-12 layout-spacing">
                                        <div class="section general-info payment-info">
                                            <div class="info">
                                                <h6 class="">Billing Address</h6>
                                                <p>Changes to your <span class="text-success">Billing</span> information will take effect starting with scheduled payment and will be refelected on your next invoice.</p>

                                                <div class="list-group mt-4" id="reloadAddress">
                                                    {% for billingAddress in billingAddresses %}
                                                        <label class="list-group-item">
                                                            <div class="d-flex w-100">
                                                                <div class="billing-radio me-2">
                                                                    <div class="form-check">
                                                                        <input class="form-check-input billingAddress" type="radio" name="billingAddress" value="{{ billingAddress.id }}" id="billingAddress{{ billingAddress.id }}"
                                                                               {% if billingAddress.status == "primary" %}checked{% endif %}>
                                                                    </div>
                                                                </div>
                                                                <div class="billing-content">
                                                                    <div class="fw-bold">{{ billingAddress.billing_name }} {% if billingAddress.status == "primary" %}<span class="badge badge-primary bg-primary">Primary</span> {% endif %}</div>
                                                                    <p>{{ billingAddress.billing_address }}</p>
                                                                </div>
                                                                <div class="billing-edit align-self-center ms-auto">
                                                                    <button class="btn btn-danger" onclick="deleteaddress('{{ billingAddress.id }}')">Delete</button>
                                                                    <button data-id="{{ billingAddress.id }}" data-bs-toggle="modal" data-bs-target="#editBillingModal" class="btn btn-dark edit_billing">Edit</button>
                                                                </div>
                                                            </div>
                                                        </label>
                                                    {% endfor %}
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                    <button class="btn btn-primary mt-4" onclick="billing_address_make_it_primary()"  id="btn-payment" style="float: right">Make Primary</button>
                                                </div>
                                                </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xl-6 col-lg-12 col-md-12 layout-spacing">
                                        <div class="section general-info payment-info">
                                            <div class="info">
                                                <h6 class="">Payment Method</h6>
                                                <p>Changes to your <span class="text-success">Payment Method</span> information will take effect starting with scheduled payment and will be refelected on your next invoice.</p>

                                                <div class="list-group mt-4" id="reloadpayment">
                                                    {% for paymentMethod in paymentMethods %}
                                                    <label class="list-group-item">
                                                        <div class="d-flex w-100">
                                                            <div class="billing-radio me-2">
                                                                <div class="form-check">
                                                                    <input class="form-check-input paymentMethod" type="radio" name="paymentMethod" value="{{ paymentMethod.id }}" id="paymentMethod{{ paymentMethod.id }}" {% if paymentMethod.status == "primary" %}checked  {% endif %}>
                                                                </div>
                                                            </div>
                                                            <div class="billing-content">
                                                                <div class="fw-bold">{{ paymentMethod.card_brand }} {% if paymentMethod.status == "primary" %}<span class="badge badge-primary bg-primary">Primary</span> {% endif %}</div>
                                                                <p>{{ paymentMethod.card_number }}</p>
                                                            </div>
                                                            <div class="billing-edit align-self-center ms-auto">
                                                                <button class="btn btn-danger" onclick="deletepayment('{{ paymentMethod.id }}')">Delete</button>
                                                                <button class="btn btn-dark edit_payment" data-id="{{ paymentMethod.id }}" data-bs-toggle="modal" data-bs-target="#editPaymentMethodModal">Edit</button>
                                                            </div>
                                                        </div>
                                                    </label>
                                                    {% endfor %}
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                        <button class="btn btn-primary mt-4" onclick="Payment_method_make_it_primary()"  id="btn-payment" style="float: right">Make Primary</button>
                                                        </div>
                                                        </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xl-6 col-lg-12 col-md-12 layout-spacing">
                                        <div class="section general-info payment-info">
                                            <div class="info">
                                                <h6 class="">Add Billing Address</h6>
                                                <p>Changes your New <span class="text-primary">Billing</span>Information.</p>
                                                  <form method="post" id="BillingForm">
                                                <div class="row mt-4">
                                                    <div class="col-md-6">
                                                        <div class="mb-3">
                                                            <label class="form-label">Name</label>
                                                            <input type="text" class="form-control add-billing-address-input" placeholder="Name" name="billing_name">
                                                            <input type="hidden"  name="user_id" value="{{ userinfo[0].id }}">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="mb-3">
                                                            <label class="form-label">Email</label>
                                                            <input type="email" class="form-control" placeholder="Email" name="billing_email">
                                                        </div>
                                                    </div>
                                                    <div class="col-12">
                                                        <div class="mb-3">
                                                            <label class="form-label">Address</label>
                                                            <input type="text" class="form-control" placeholder="Address" name="billing_address">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="mb-3">
                                                            <label class="form-label">City</label>
                                                            <input type="text" class="form-control" placeholder="City" name="billing_city">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="mb-3">
                                                            <label class="form-label">Country</label>
                                                            <select class="form-select" name="billing_country">
                                                                <option selected="">Choose Country</option>
                                                                {% for country in countries %}
                                                                    <option value="{{ country.code }}">{{ country.name }}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="mb-3">
                                                            <label class="form-label">ZIP Code</label>
                                                            <input type="text" class="form-control" placeholder="ZIP Code" name="billing_zip">
                                                        </div>
                                                    </div>
                                                </div>
                                                <button class="btn btn-primary mt-4" type="button" onclick="add_billing_address()"  id="btn-billing">Add</button>
                                                  </form>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xl-6 col-lg-12 col-md-12 layout-spacing">
                                        <div class="section general-info payment-info">
                                            <div class="info">
                                                <h6 class="">Add Payment Method</h6>
                                                <p>Changes your New <span class="text-primary">Payment Method</span> Information.</p>
                                                <form method="post" id="PaymentMethodForm">
                                                    <input type="hidden"  name="user_id" value="{{ userinfo[0].id }}">
                                                <div class="row mt-4">
                                                    <div class="col-md-6">
                                                        <div class="mb-3">
                                                            <label class="form-label">Card Brand</label>
                                                            <select class="form-select" name="card_brand">
                                                                <option value="Mastercard" >
                                                                  Mastercard
                                                                </option>
                                                                <option value="American Express">
                                                                 American Express
                                                                </option>
                                                                <option value="Visa">
                                                                   Visa
                                                                </option>
                                                                <option value="Discover">
                                                                   Discover
                                                                </option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="mb-3">
                                                            <label class="form-label">Card Number</label>
                                                            <input type="text" class="form-control " name="card_number">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="mb-3">
                                                            <label class="form-label">Holder Name</label>
                                                            <input type="text" class="form-control" name="holder_name">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="mb-3">
                                                            <label class="form-label">CVV/CVV2</label>
                                                            <input type="text" class="form-control" name="cvv">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="mb-3">
                                                            <label class="form-label">Card Expiry</label>
                                                            <input type="month" class="form-control" name="card_expiry">
                                                        </div>
                                                    </div>
                                                </div>
                                                </form>
                                                <button class="btn btn-primary mt-4" onclick="add_payment_method()"  id="btn-payment">Add</button>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class="tab-pane fade" id="animated-underline-contact" role="tabpanel" aria-labelledby="animated-underline-contact-tab">
                                <div class="row">
                                    <div class="col-xl-12 col-lg-12 col-md-12 layout-spacing">
                                        <div class="section general-info mb-3">
                                        <div class="info">
                                            <form method="post" id="passwordForm">
                                            <div class="row">
                                                <h5 class="">Change Password</h5>
                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                        <label for="current_password">Current Password</label>
                                                        <input type="password" class="form-control mb-3" id="current_password" name="current_password" placeholder="Current Password" >
                                                        <input type="hidden"  id="idForPassword"  value="{{ userinfo[0].id }}">
                                                        <input type="hidden" name="csrf" value="{{csrf}}">
                                                    </div>
                                                </div>

                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label for="new_password">New Password</label>
                                                        <input type="password" class="form-control mb-3" id="new_password" name="new_password" placeholder="New Password" >
                                                    </div>
                                                </div>

                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label for="confirm_password">Confirm Password</label>
                                                        <input type="password" class="form-control mb-3" id="confirm_password" name="confirm_password" placeholder="Confirm Password">
                                                    </div>
                                                </div>
                                                <div class="col-md-12 mt-1">
                                                    <div class="form-group text-end">
                                                        <button type="button" class="btn btn-secondary" id="btn-password" onclick="change_password()">Change Password</button>
                                                    </div>
                                                </div>
                                            </div>
                                            </form>
                                        </div>
                                        </div>
                                        <div class="section general-info">
                                            <div class="info">
                                                <h6 class="">Two-factor authentication Settings</h6>
                                                <p>You can on or off 2FA</p>
                                                {% if userinfo.twofa_status == "off" %}
                                                    <div class="form-group mt-4">
                                                        <div class="switch form-switch-custom switch-inline form-switch-success mt-1">
                                                            <input class="switch-input" type="checkbox" role="switch"  id="socialformprofile-custom-switch-success" onclick="twofaStatus('{{ userinfo[0].id }}', 1)">
                                                        </div>
                                                    </div>
                                                {% else %}
                                                    <div class="form-group mt-4">
                                                        <div class="switch form-switch-custom switch-inline form-switch-success mt-1">
                                                            <input class="switch-input" type="checkbox" role="switch" checked id="socialformprofile-custom-switch-success" onclick="twofaStatus('{{ userinfo[0].id }}', 0)">
                                                        </div>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>

            </div>

        </div>

        <!--  BEGIN FOOTER  -->
        <div class="footer-wrapper">
            <div class="footer-wrapper">
                <div class="footer-section f-section-1">
                    <p class="">Copyright  <span class="dynamic-year">2024</span> <a target="_blank" href="https://zotecsoft.com/">ZotecSoft</a>, All rights reserved.</p>
                </div>
            </div>
        </div>
        <!--  END FOOTER  -->

    </div>
    <div class="modal fade" id="editBillingModal" tabindex="-1" aria-labelledby="editBillingModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content bg-white">
                <div class="modal-header">
                    <h5 class="modal-title" id="editBillingModalLabel">Edit Billing Address</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="btn-close"></button>
                </div>
                <form  method="post" id="editBillingForm" enctype="multipart/form-data">
                    <input type="hidden" class="form-control " name="id" id="id">
                    <div class="modal-body">
                        <div class="row p-1">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Name</label>
                                    <input type="text" class="form-control add-billing-address-input" placeholder="Name" id="billing_name" name="billing_name">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" placeholder="Email" name="billing_email" id="billing_email">
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="mb-3">
                                    <label class="form-label">Address</label>
                                    <input type="text" class="form-control" placeholder="Address" name="billing_address" id="billing_address">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">City</label>
                                    <input type="text" class="form-control" placeholder="City" name="billing_city" id="billing_city">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Country</label>
                                    <select class="form-select" name="billing_country" id="billing_country">
                                        <option selected="">Choose Country</option>
                                        {% for country in countries %}
                                            <option value="{{ country.code }}">{{ country.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">ZIP Code</label>
                                    <input type="text" class="form-control" placeholder="ZIP Code" name="billing_zip" id="billing_zip">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button"  class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" id="edit-btn-billing" class="btn btn-primary" onclick="update_billing_address()">Update</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal fade" id="editPaymentMethodModal" tabindex="-1" aria-labelledby="editPaymentMethodModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content bg-white">
                <div class="modal-header">
                    <h5 class="modal-title" id="editPaymentMethodModalLabel">Edit Payment Method</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="btn-close"></button>
                </div>
                <form  method="post" id="editPaymentMethodForm" enctype="multipart/form-data">
                    <input type="hidden" class="form-control " name="id" id="id">

                    <div class="modal-body">
                        <div class="row p-1">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Card Brand</label>
                                    <select class="form-select" name="card_brand" id="card_brand">
                                        <option value="Mastercard" >
                                            Mastercard
                                        </option>
                                        <option value="American Express">
                                            American Express
                                        </option>
                                        <option value="Visa">
                                            Visa
                                        </option>
                                        <option value="Discover">
                                            Discover
                                        </option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Card Number</label>
                                    <input type="text" class="form-control " name="card_number" id="card_number">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Holder Name</label>
                                    <input type="text" class="form-control" name="holder_name" id="holder_name">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">CVV/CVV2</label>
                                    <input type="text" class="form-control" name="cvv" id="cvv">
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="mb-3">
                                    <label class="form-label">Card Expiry</label>
                                    <input type="month" class="form-control" name="card_expiry" id="card_expiry">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button"  class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" name="add_new" id="edit-btn-payment" class="btn btn-primary" onclick="update_payment_method()">Update</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!--  END CONTENT AREA  -->
        <script>
            var company_image = {{  userinfo[0].company_image|json_encode|raw }};
            var profile_image = {{  userinfo[0].profile_image|json_encode|raw }};
        function do_company_profile() {
            document.getElementById('btn').disabled = true;
            var formData =  new FormData(document.getElementById("company_information"));
            pond1.getFiles().forEach(fileItem => {
                formData.append('filepond1', fileItem.file);
            });
            $.ajax({
                url: "/user/company/profile",
                type: "POST",
                data: formData,
                contentType: false,
                cache: false,
                processData: false,
                success: function (dataResult) {
                    console.log(dataResult);
                    if(dataResult== 1){
                        document.getElementById('btn').disabled = false;
                        toastr.success('Updated Successfully.');
                        document.getElementById("company_information").reset();
                        fetch_profile()
                        pond.removeFiles();
                        location.reload();
                    }
                    else if(dataResult==2){
                        toastr.error("Please Fill all the required Fields");
                        document.getElementById('btn').disabled = false;
                    }else{
                        toastr.error('Something Went Wrong.');
                        document.getElementById('btn').disabled = false;
                    }
                }
            });
        }
        function do_bank_details() {
            document.getElementById('btn').disabled = true;
            var formData =  new FormData(document.getElementById("bank_details"));

            $.ajax({
                url: "/user/bank/profile",
                type: "POST",
                data: formData,
                contentType: false,
                cache: false,
                processData: false,
                success: function (dataResult) {
                    console.log(dataResult);
                    if(dataResult== 1){
                        document.getElementById('btn').disabled = false;
                        toastr.success('Updated Successfully.');
                        fetch_profile()
                    }
                    else if(dataResult==2){
                        toastr.error("Please Fill all the required Fields");
                        document.getElementById('btn').disabled = false;
                    }else{
                        toastr.error('Something Went Wrong.');
                        document.getElementById('btn').disabled = false;
                    }
                }
            });
        }
        function do_profile() {
            document.getElementById('btn').disabled = true;
            var formData = new FormData(document.getElementById("general_information"));

            // Append FilePond files to FormData
            pond.getFiles().forEach(fileItem => {
                formData.append('filepond', fileItem.file);
            });

            $.ajax({
                url: "/user/profile",
                type: "POST",
                data: formData,
                contentType: false,
                cache: false,
                processData: false,
                success: function (dataResult) {
                    console.log(dataResult);
                    if (dataResult == 1) {
                        document.getElementById('btn').disabled = false;
                        toastr.success('Updated Successfully.');
                        document.getElementById("general_information").reset();
                        pond.removeFiles();
                        location.reload();
                        fetch_profile()
                    } else if (dataResult == 2) {
                        toastr.error("Please Fill all the required Fields");
                        document.getElementById('btn').disabled = false;
                    } else {
                        toastr.error('Something Went Wrong.');
                        document.getElementById('btn').disabled = false;
                    }
                }
            });
        }
            $(document).ready(function(){
                fetch_profile()
            });
            var profile_image;
            function fetch_profile() {
                var id = {{ loginId }};
                $('#general_information').trigger("reset");
                $.ajax({
                    url: "/user/fetch_profile",
                    type: "POST",
                    data: {
                        edit: 1,
                        id: id,
                    },
                    cache: false,
                    success: function (dataResult) {
                        var dataResult = JSON.parse(dataResult);
                        console.log(dataResult);
                        $('#fname').val(dataResult[0].fname);
                        $('#lname').val(dataResult[0].lname);
                        $('#phone').val(dataResult[0].phone);
                        $('#email').val(dataResult[0].email);
                    }
                });
            }
            fetch_profile();
        $('body').on('click', '.edit_billing', function () {
            var id = $(this).data('id');
            $('#editBillingForm').trigger("reset");
            $.ajax({
                url: "/user/get_billing_address",
                type: "POST",
                data: {
                    edit: 1,
                    id: id,
                },
                cache: false,
                success: function (dataResult) {
                    fetch_profile()
                    var dataResult = JSON.parse(dataResult);
                    console.log(dataResult);
                    $('#billing_name').val(dataResult[0].billing_name);
                    $('#billing_email').val(dataResult[0].billing_email);
                    $('#billing_address').val(dataResult[0].billing_address);
                    $('#billing_city').val(dataResult[0].billing_city);
                    $('#billing_country').val(dataResult[0].billing_country);
                    $('#billing_zip').val(dataResult[0].billing_zip);
                    $('input[name=id]').val(dataResult[0].id);
                }
            });
        });
        $('body').on('click', '.edit_payment', function () {
            var id = $(this).data('id');

            $('#editPaymentMethodForm').trigger("reset");

            $.ajax({
                url: "/user/get_payment_method",
                type: "POST",
                data: {
                    edit: 1,
                    id: id,
                },
                cache: false,
                success: function (dataResult) {
                    fetch_profile()
                    var dataResult = JSON.parse(dataResult);
                    console.log(dataResult);
                    $('#card_brand').val(dataResult[0].card_brand);
                    $('#card_number').val(dataResult[0].card_number);
                    $('#holder_name').val(dataResult[0].holder_name);
                    $('#cvv').val(dataResult[0].cvv);
                    $('#card_expiry').val(dataResult[0].card_expiry);
                    $('input[name=id]').val(dataResult[0].id);
                }
            });
        });
        function add_billing_address() {
            document.getElementById('btn-billing').disabled = true;
            var formData =  new FormData(document.getElementById("BillingForm"));
            $.ajax({
                url: "/user/add_billing_address",
                type: "POST",
                data: formData,
                contentType: false,
                cache: false,
                processData: false,
                success: function (dataResult) {
                    console.log(dataResult);
                    if(dataResult== 1){
                        document.getElementById('btn-billing').disabled = false;
                        toastr.success('Add Successfully.');
                        document.getElementById("BillingForm").reset();
                        $('#reloadAddress').load(window.location.href + ' #reloadAddress');
                        fetch_profile()
                    }
                    else if(dataResult==2){
                        toastr.error("Please Fill all the required Fields");
                        document.getElementById('btn-billing').disabled = false;
                    }else{
                        toastr.error('Something Went Wrong.');
                        document.getElementById('btn-billing').disabled = false;
                    }

                }
            });

        }
        function update_billing_address() {
            document.getElementById('edit-btn-billing').disabled = true;
            var formData =  new FormData(document.getElementById("editBillingForm"));
            $.ajax({
                url: "/user/update_billing_address",
                type: "POST",
                data: formData,
                contentType: false,
                cache: false,
                processData: false,
                success: function (dataResult) {
                    console.log(dataResult);
                    if(dataResult== 1){
                        document.getElementById('edit-btn-billing').disabled = false;
                        toastr.success('Updated Successfully.');
                        document.getElementById("editBillingForm").reset();
                        $('#editBillingModal').modal('hide');
                        $('#reloadAddress').load(window.location.href + ' #reloadAddress');
                        fetch_profile()
                    }
                    else if(dataResult==2){
                        toastr.error("Please Fill all the required Fields");
                        document.getElementById('edit-btn-billing').disabled = false;
                    }else{
                        toastr.error('Something Went Wrong.');
                        document.getElementById('edit-btn-billing').disabled = false;
                    }

                }
            });

        }
        function add_payment_method() {
            document.getElementById('btn-payment').disabled = true;
            var formData =  new FormData(document.getElementById("PaymentMethodForm"));
            $.ajax({
                url: "/user/add_payment_method",
                type: "POST",
                data: formData,
                contentType: false,
                cache: false,
                processData: false,
                success: function (dataResult) {
                    console.log(dataResult);
                    if(dataResult== 1){
                        document.getElementById('btn-payment').disabled = false;
                        toastr.success('Add Successfully.');
                        document.getElementById("PaymentMethodForm").reset();
                        $('#reloadpayment').load(window.location.href + ' #reloadpayment');
                        fetch_profile()
                    }
                    else if(dataResult==2){
                        toastr.error("Please Fill all the required Fields");
                        document.getElementById('btn-payment').disabled = false;
                    }else{
                        toastr.error('Something Went Wrong.');
                        document.getElementById('btn-payment').disabled = false;
                    }

                }
            });

        }
        function update_payment_method() {
            document.getElementById('edit-btn-payment').disabled = true;
            var formData =  new FormData(document.getElementById("editPaymentMethodForm"));
            $.ajax({
                url: "/user/update_payment_method",
                type: "POST",
                data: formData,
                contentType: false,
                cache: false,
                processData: false,
                success: function (dataResult) {
                    console.log(dataResult);
                    if(dataResult== 1){
                        document.getElementById('edit-btn-payment').disabled = false;
                        toastr.success('Updated Successfully.');
                        document.getElementById("editPaymentMethodForm").reset();
                        $('#editPaymentMethodModal').modal('hide');
                        $('#reloadpayment').load(window.location.href + ' #reloadpayment');
                        fetch_profile()
                    }
                    else if(dataResult==2){
                        toastr.error("Please Fill all the required Fields");
                        document.getElementById('edit-btn-payment').disabled = false;
                    }else{
                        toastr.error('Something Went Wrong.');
                        document.getElementById('edit-btn-payment').disabled = false;
                    }

                }
            });

        }
        function deleteaddress(deleteid) {
            var el = this;
            $(this).prop("disabled", true);
            // add spinner to button
            $(this).html('<i class="fa fa-circle-o-notch fa-spin"></i> loading...');
            var csrf_token = $("input[name=csrf]").val();
            $.ajax({
                url: '/user/api',
                type: 'GET',
                data: {
                    id: deleteid,
                    page_name: "deleteFromProfile",
                    table_name: "billing_address",
                    csrf: csrf_token
                }, success: function (data) {
                    fetch_profile()
                    console.log(data);
                    toastr.clear();
                    if (data == 1) {
                        toastr.success('Successfully deleted.');
                        $('#reloadAddress').load(window.location.href + ' #reloadAddress');
                    } else {
                        toastr.error("Something Went Wrong.");
                    }
                }
            });
        }
        function deletepayment(deleteid) {
            var el = this;
            $(this).prop("disabled", true);
            // add spinner to button
            $(this).html('<i class="fa fa-circle-o-notch fa-spin"></i> loading...');
            var csrf_token = $("input[name=csrf]").val();
            $.ajax({
                url: '/user/api',
                type: 'GET',
                data: {
                    id: deleteid,
                    page_name: "deleteFromProfile",
                    table_name: "user_payment_method",
                    csrf: csrf_token
                }, success: function (data) {
                    fetch_profile()
                    console.log(data);
                    toastr.clear();
                    if (data == 1) {
                        toastr.success('Successfully deleted.');
                        $('#reloadpayment').load(window.location.href + ' #reloadpayment');
                    } else {
                        toastr.error("Something Went Wrong.");
                    }
                }
            });
        }
        function billing_address_make_it_primary() {
            var checkedValue = document.querySelector('.billingAddress:checked').value;
            $(this).html('<i class="fa fa-circle-o-notch fa-spin"></i> loading...');
            var csrf_token = $("input[name=csrf]").val();
            $.ajax({
                url: '/user/api',
                type: 'GET', data: {
                    id: checkedValue,
                    page_name: "profileStatusUpdate",
                    table_name:"billing_address",
                    status_table:"status",
                    csrf: csrf_token
                }, success: function (data) {
                    if (data == 1) {
                        fetch_profile()
                        toastr.success('You Make This Address Primary');
                        $('#reloadAddress').load(window.location.href + ' #reloadAddress');
                    } else {
                        toastr.error('Something went wrong.');

                    }
                }

            });
        }
        function Payment_method_make_it_primary() {
            var checkedValue = document.querySelector('.paymentMethod:checked').value;
            $(this).html('<i class="fa fa-circle-o-notch fa-spin"></i> loading...');
            var csrf_token = $("input[name=csrf]").val();
            $.ajax({
                url: '/user/api',
                type: 'GET', data: {
                    id: checkedValue,
                    page_name: "profileStatusUpdate",
                    table_name:"user_payment_method",
                    status_table:"status",
                    csrf: csrf_token
                }, success: function (data) {
                    if (data == 1) {
                        fetch_profile()
                        toastr.success('You Make This Payment Method Primary');
                        $('#reloadpayment').load(window.location.href + ' #reloadpayment');
                    } else {
                        toastr.error('Something went wrong.');

                    }
                }

            });
        }
        function change_password() {
            var id = $("#idForPassword").val();
            var current_password = $("#current_password").val();
            var new_password = $("#new_password").val();
            var confirm_password = $("#confirm_password").val();
            var csrf_token = $("input[name=csrf]").val();

            if (current_password != "" && new_password != "" && confirm_password != "") {
            if ( new_password == confirm_password) {
                document.getElementById("btn-password").innerHTML = "Loading";
                $("#btn-password").attr("disabled");
                $.ajax
                ({
                    type: 'post',
                    url: '/user/profile/password_change',
                    data: {
                        do_profile: "do_profile",
                        id: id,
                        current_password: current_password,
                        new_password: new_password,
                        confirm_password: confirm_password,
                        csrf: csrf_token,
                    },
                    success: function (response) {
                        response = $.parseJSON(response);
                        if(response== 1){
                            $("#btn-password").removeAttr("disabled");
                            toastr.success('Update Successfully.');
                            document.getElementById("btn-password").innerHTML = "Change Password";
                        } else if(response==2){
                            toastr.error("Incorrect Current Password");
                            $("#btn-password").removeAttr("disabled");
                        } else{
                            toastr.error('Somthing Went Wrong.');
                            $("#btn-password").removeAttr("disabled");
                        }
                    }
                });
            }else{
                document.getElementById("btn-password").innerHTML = "Change Password";
                document.getElementById("btn-password").disabled = false;
                toastr.error("Password Doesn't Match ");
            }
            }else{
                document.getElementById("btn-password").innerHTML = "Change Password";
                 document.getElementById("btn-password").disabled = false;
                toastr.error("Missing Required Input");

            }
            return false;
        }
        function twofaStatus(userID, status) {

            if(status == 0){
                var currStatus= "off";
            }else{
                var currStatus= "on";
            }
            var el = this;
            $(this).html('<i class="fa fa-circle-o-notch fa-spin"></i> loading...');
            var csrf_token = $("input[name=csrf]").val();
            $.ajax({
                url: '/user/api',
                type: 'GET', data: {
                    id: userID,
                    status: currStatus,
                    page_name: "userStatusUpdate",
                    table_name:"users",
                    status_table:"twofa_status",
                    csrf: csrf_token
                }, success: function (data) {
                    fetch_profile()
                    if (data == 1) {
                        toastr.success('2FA Updated.');
                    } else {
                        toastr.error('Something went wrong.');

                    }
                }

            });
        }
    </script>

{% endblock %}