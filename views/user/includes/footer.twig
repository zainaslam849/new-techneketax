<div class="footer py-4 d-flex flex-lg-column" id="kt_footer">
    <!--begin::Container-->
    <div class="container-fluid d-flex flex-column flex-md-row align-items-center justify-content-between">
        <!--begin::Copyright-->
        <div class="text-dark order-2 order-md-1">
            <span class="text-muted fw-bold me-1">2022Â©</span>
            <a href="https://keenthemes.com" target="_blank" class="text-gray-800 text-hover-primary">Keenthemes</a>
        </div>
        <!--end::Copyright-->
        <!--begin::Menu-->
        <ul class="menu menu-gray-600 menu-hover-primary fw-bold order-1">
            <li class="menu-item">
                <a href="https://keenthemes.com" target="_blank" class="menu-link px-2">About</a>
            </li>
            <li class="menu-item">
                <a href="https://devs.keenthemes.com" target="_blank" class="menu-link px-2">Support</a>
            </li>
            <li class="menu-item">
                <a href="https://1.envato.market/EA4JP" target="_blank" class="menu-link px-2">Purchase</a>
            </li>
        </ul>
        <!--end::Menu-->
    </div>
    <!--end::Container-->
</div>

</div>

</div>

</div>

<div id="kt_scrolltop" class="scrolltop" data-kt-scrolltop="true">
    <!--begin::Svg Icon | path: icons/duotune/arrows/arr066.svg-->
    <span class="svg-icon">
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
					<rect opacity="0.5" x="13" y="6" width="13" height="2" rx="1" transform="rotate(90 13 6)" fill="currentColor" />
					<path d="M12.5657 8.56569L16.75 12.75C17.1642 13.1642 17.8358 13.1642 18.25 12.75C18.6642 12.3358 18.6642 11.6642 18.25 11.25L12.7071 5.70711C12.3166 5.31658 11.6834 5.31658 11.2929 5.70711L5.75 11.25C5.33579 11.6642 5.33579 12.3358 5.75 12.75C6.16421 13.1642 6.83579 13.1642 7.25 12.75L11.4343 8.56569C11.7467 8.25327 12.2533 8.25327 12.5657 8.56569Z" fill="currentColor" />
				</svg>
			</span>
    <!--end::Svg Icon-->
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js" integrity="sha512-VEd+nq25CkR676O+pLBnDW09R7VQX9Mdiij052gVCp5yVH3jGtH70Ho/UUv4mJDsEdTvqRCFZg0NKGiojGnUCw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="{{ env.APP_URL }}assets/dash/assets/plugins/global/plugins.bundle.js"></script>
<script src="{{ env.APP_URL }}assets/dash/assets/js/scripts.bundle.js"></script>
<script src="{{ env.APP_URL }}assets/dash/assets/plugins/custom/datatables/datatables.bundle.js"></script>
<script src="{{ env.APP_URL }}assets/dash/assets/plugins/custom/fullcalendar/fullcalendar.bundle.js"></script>
<script src="{{ env.APP_URL }}assets/dash/assets/plugins/custom/datatables/datatables.bundle.js"></script>
<script src="{{ env.APP_URL }}assets/dash/assets/js/widgets.bundle.js"></script>
<script src="{{ env.APP_URL }}assets/dash/assets/js/custom/widgets.js"></script>
<script src="{{ env.APP_URL }}assets/dash/assets/js/custom/apps/chat/chat.js"></script>
<script src="{{ env.APP_URL }}assets/dash/assets/js/custom/utilities/modals/upgrade-plan.js"></script>
<script src="{{ env.APP_URL }}assets/dash/assets/js/custom/utilities/modals/create-app.js"></script>
<script src="{{ env.APP_URL }}assets/dash/assets/js/custom/utilities/modals/users-search.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
{#<script src="{{ env.APP_URL }}assets/dashboard/src/assets/js/apps/invoice-edit.js"></script>#}
{#<script src="{{ env.APP_URL }}assets/dashboard/src/assets/js/users/account-settings.js"></script>#}
<script>
    $(document).ready(function() {
        // Load the spinner initially
        $('#spinner-outer').show();

        // Use setTimeout to delay the loading of the content
        setTimeout(function() {
            // Hide the spinner and show the content with an animation
            $('#spinner-outer').hide();
            $('#content-container').fadeIn(500); // or slideDown, etc.
        }, 2000); // adjust this value as needed

    });

</script>

<script>

    $(document).ready(function() {
        var loginId = '{{ loginId }}'; // Replace with your actual loginId
        var ringtone = document.getElementById('ringtone');
        var notificationSent = false; // To track if the notification has been sent

        // Function to request user interaction for audio playback
        function enableAudio() {
            // Add a global click event listener to enable audio
            $(document).one('click', function() {
                ringtone.play().catch(function(error) {
                    console.error('Playback failed:', error);
                });
            });
        }

 

        let NotificationSent = false;
        let CallAlertShown = false; // Track if the call alert has been shown

// Function to check for incoming calls
        function checkForCall() {
            $.ajax({
                url: '/call/check',
                type: 'POST',
                data: { loginId: loginId },
                dataType: 'json',
                success: function(response) {
                    if (response.status === 'ringing') {
                        var callerName = response.caller_name;
                        const channel_id = response.channel_id;
                        const callLink = response.call_link;

                        // Show the call alert if not already shown
                        if (!CallAlertShown) {
                            $('#call-ringing').html(`
                        <div id="call-alert" class="alert custom-alert-1 rounded-3 fade show mb-4" role="alert" style="z-index: 999; margin-top:20px;">
                            <div class="media">
                                <div class="media-body">
                                    <div class="alert-text pt-0">
                                        <h5 class="text-light">
                                            <div class="avatar avatar-sm avatar-indicators avatar-online">
                                                <img alt="avatar" src="https://techneketax.local/assets/dashboard/src/assets/img/profile-30.png" class="rounded-circle">
                                            </div>
                                            <span class="pt-3">Video call from ${callerName}</span>
                                        </h5>
                                    </div>
                                    <div class="alert-btn p-2 text-center" style="letter-spacing: 60px;">
                                        <button onclick="hangUpCall('${channel_id}')" type="button" class="btn btn-lg btn-danger rounded-5">
                                            <img width="24px" src="{{ env.APP_URL }}assets/img/phone-hangup.png" alt="">
                                        </button>
                                        <a href="${callLink}" type="button" class="btn btn-lg btn-success rounded-5">
                                            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1">
                                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                                            </svg>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `);
                            CallAlertShown = true; // Mark that the alert has been shown

                            window.scrollTo(0, 0);

                            if (!NotificationSent) {
                                showNotification(callerName, callLink);
                                NotificationSent = true; // Mark that the notification has been sent
                            }

                            // Play the ringtone
                            // ringtone.play().catch(function(error) {
                            //     console.error('Playback failed:', error);
                            // });
                        }
                    } else if (response.status === 'hangup' && CallAlertShown) {
                        // Remove the call alert if the call has been hung up
                        $('#call-alert').remove();
                        CallAlertShown = false; // Reset alert shown status
                        otificationSent = false; // Reset notification sent status
                    }
                },
                error: function(xhr, status, error) {
                    console.error('AJAX Error: ' + status + error);
                }
            });
        }



        // Request notification permission
        requestNotificationPermission();

        // Call enableAudio to ensure audio can be played
       // enableAudio();

        // Check for calls every 2 seconds
        setInterval(checkForCall, 2000);
    });

    function requestNotificationPermission() {
        if (Notification.permission === 'default') {
            Notification.requestPermission().then(function(permission) {
                if (permission === 'granted') {
                    console.log('Notification permission granted.');
                } else {
                    console.log('Notification permission denied.');
                }
            });
        }
    }

    function showNotification(callerName, callLink) {
        if (Notification.permission === 'granted') {
            var options = {
                body: `Video call from ${callerName}`,
                icon: 'https://techneketax.local/assets/dashboard/src/assets/img/profile-30.png'
            };

            var notification = new Notification('Incoming Call', options);

            notification.onclick = function(event) {
                event.preventDefault(); // Prevent the default action (e.g., focus the tab)
                window.open(callLink, '_blank'); // Open the call link
            };

            notification.onclose = function() {
                console.log('Notification closed.');
            };
        }
    }
    function hangUpCall(channelId) {
        $.ajax({
            url: '/call/hangup/' + encodeURIComponent(channelId),
            type: 'POST',
            dataType: 'json',
            success: function(response) {
                if (response.status === true) {
                    // Redirect to /user/chat if status is true
                    window.location.href = '/user/chat';
                } else {
                    console.error('Hangup failed: ', response.message || 'Unknown error');
                }
            },
            error: function(xhr, status, error) {
                console.error('AJAX Error: ' + status + ' - ' + error);
            }
        });
    }
    document.addEventListener("DOMContentLoaded", function() {
        setTimeout(function() {
            // Hide the skeleton loader
            var loader = document.getElementById("sidebar-loader");
            if (loader) {
                loader.style.display = "none";
            }

            // Show the actual sidebar content
            var sidebar = document.getElementById("actual-sidebar");
            if (sidebar) {
                sidebar.style.display = "block";
            }
        }, 1000); // 2000ms = 2 seconds
    });



    {#                $('#call-ringing').html(`#}
    {#                        <div class="alert custom-alert-1 rounded-3 fade show mb-4" role="alert" style="position: fixed; z-index: 999; margin-top:-20px;">#}
    {#                            <div class="media">#}

    {#                                <div class="media-body">#}
    {#                                    <div class="alert-text pt-0">#}
    {#                                        <h5 class="text-light">#}
    {#                                            <div class="avatar avatar-sm avatar-indicators avatar-online">#}
    {#                                                <img alt="avatar" src="https://techneketax.local/assets/dashboard/src/assets/img/profile-30.png" class="rounded-circle">#}
    {#                                            </div>#}
    {#                                            <span class="pt-3">Video call from ${callerName}</span>#}
    {#                                        </h5>#}
    {#                                    </div>#}
    {#                                    <div class="alert-btn p-2 text-center">#}
    {#                                        <button type="button" class="btn btn-danger rounded-5">#}
    {#                                            <img width="24px" src="{{ env.APP_URL }}assets/img/phone-hangup.png" alt="">#}
    {#                                        </button>#}
    {#                                        <a href="${callLink}" type="button" class="btn btn-success rounded-5">#}
    {#                                            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1">#}
    {#                                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>#}
    {#                                            </svg>#}
    {#                                        </a>#}
    {#                                    </div>#}
    {#                                </div>#}
    {#                            </div>#}
    {#                        </div>#}
    {#                    `);#}
    {#            }#}
    {#        },#}
    {#        error: function(xhr, status, error) {#}
    {#            console.error('AJAX Error: ' + status + error);#}
    {#        }#}
    {#    });#}
    {#});#}

</script>


</body>
</html>