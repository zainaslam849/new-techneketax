{% extends 'user/master.twig' %}
{% block content %}
    <!--  BEGIN CONTENT AREA  -->
    <div id="content" class="main-content">
        <div class="layout-px-spacing">

            <div class="middle-content container-xxl p-0">
                <div id="call-ringing"></div>

                <div class="row invoice layout-top-spacing layout-spacing">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">

                        <div class="doc-container">

                            <div class="row">

                                <div class="col-xl-9">

                                    <div class="invoice-container">
                                        <div class="invoice-inbox" id="printableArea">

                                            <div id="ct" class="">

                                                <div class="invoice-00001">
                                                    <div class="content-section">

                                                        <div class="inv--head-section inv--detail-section">

                                                            <div class="row">

                                                                <div class="col-sm-6 col-12 mr-auto">
                                                                    <div class="d-flex">
                                                                        {% if whitelabel == "no" %}
                                                                            <img width="40%" src="{{ env.APP_URL }}uploads/settings/{{ logo }}" alt="avatar" class="img-fluid" style="    width: 200px;">
                                                                        {% else %}
                                                                            {% if userCompanyImage != "null" and userCompanyImage != "" %}
                                                                                <img width="40%" src="{{ env.APP_URL }}uploads/profile/{{ userCompanyImage }}" alt="avatar" class="img-fluid" style="    width: 200px;">
                                                                            {% else %}
                                                                                <img width="40%" src="{{ env.APP_URL }}uploads/settings/{{ logo }}" alt="avatar" class="img-fluid" style="    width: 200px;">
                                                                            {% endif %}
                                                                        {% endif %}
                                                                    </div>
                                                                    <p class="inv-street-addr mt-3">{{ invoiceInfo[0].firm_address }}</p>
                                                                    <p class="inv-email-address">{{ invoiceInfo[0].firm_email }}</p>
                                                                    <p class="inv-email-address">{{ invoiceInfo[0].firm_phone }}</p>
                                                                </div>

                                                                <div class="col-sm-6 text-sm-end">
                                                                    <p class="inv-list-number mt-sm-3 pb-sm-2 mt-4"><span class="inv-title">Invoice : </span> <span class="inv-number">{{ invoiceInfo[0].invoice_number }}</span></p>
                                                                    <p class="inv-created-date mt-sm-5 mt-3"><span class="inv-title">Invoice Date : </span> <span class="inv-date">{{ invoiceInfo[0].invoice_date }}</span></p>
                                                                    <p class="inv-due-date"><span class="inv-title">Due Date : </span> <span class="inv-date">{{ invoiceInfo[0].due_date }}</span></p>
                                                                </div>
                                                            </div>

                                                        </div>

                                                        <div class="inv--detail-section inv--customer-detail-section">

                                                            <div class="row">

                                                                <div class="col-xl-8 col-lg-7 col-md-6 col-sm-4 align-self-center">
                                                                    <p class="inv-to">Invoice To</p>
                                                                </div>

                                                                <div class="col-xl-4 col-lg-5 col-md-6 col-sm-8 align-self-center order-sm-0 order-1 text-sm-end mt-sm-0 mt-5">
                                                                    <h6 class=" inv-title">Invoice From</h6>
                                                                </div>

                                                                <div class="col-xl-8 col-lg-7 col-md-6 col-sm-4">
                                                                    <p class="inv-customer-name">{{ clientInfo[0].fname }} {{ clientInfo[0].lname }}</p>
                                                                    <p class="inv-street-addr">{{ invoiceInfo[0].client_address }}</p>
                                                                    <p class="inv-email-address">{{ invoiceInfo[0].client_email }}</p>
                                                                    <p class="inv-email-address">{{ invoiceInfo[0].client_phone }}</p>
                                                                </div>

                                                                <div class="col-xl-4 col-lg-5 col-md-6 col-sm-8 col-12 order-sm-0 order-1 text-sm-end">
                                                                    <p class="inv-customer-name">{{ invoiceInfo[0].firm_name }}</p>
                                                                    <p class="inv-street-addr">{{ invoiceInfo[0].firm_address }} </p>
                                                                    <p class="inv-email-address">{{ invoiceInfo[0].firm_email }}</p>
                                                                    <p class="inv-email-address">{{ invoiceInfo[0].firm_phone }}</p>
                                                                </div>

                                                            </div>

                                                        </div>

                                                        <div class="inv--product-table-section">
                                                            <div class="table-responsive">
                                                                <table class="table">
                                                                    <thead class="">
                                                                    <tr>
                                                                        <th scope="col">S.No</th>
                                                                        <th scope="col">Items</th>
                                                                        <th class="text-end" scope="col">Qty</th>
                                                                        <th class="text-end" scope="col">Price</th>
                                                                        <th class="text-end" scope="col">Amount</th>
                                                                    </tr>

                                                                    </thead>
                                                                    <tbody>
                                                                    {% set item_des = ProductDetails.item_des ? ProductDetails.item_des|split(',') : [] %}
                                                                    {% set price = ProductDetails.price ? ProductDetails.price|split(',') : [] %}
                                                                    {% set quantity = ProductDetails.quantity ? ProductDetails.quantity|split(',') : [] %}
                                                                    {% set amount_item = ProductDetails.amount_item ? ProductDetails.amount_item|split(',') : [] %}
                                                                    {% set hasData = item_des|filter(v => v != '')|length > 0 or price|filter(v => v != '')|length > 0 or quantity|filter(v => v != '')|length > 0 or amount_item|filter(v => v != '')|length > 0 %}

                                                                    {% if hasData %}
                                                                        {% for i in 0..item_des|length - 1 %}
{#                                                                            {% if item_des[i] is empty and price[i] is empty and quantity[i] is empty and amount_item[i] is empty %}#}
{#                                                                                {% continue %} #}
{#                                                                            {% endif %}#}
                                                                            {% set SrNo = i + 1 %}
                                                                            <tr>
                                                                                <td>{{ SrNo }}</td>
                                                                                <td>{{ item_des[i]|e }}</td>
                                                                                <td class="text-end">{{ quantity[i]|e }}</td>
                                                                                <td class="text-end">${{ price[i]|e }}</td>
                                                                                <td class="text-end">${{ amount_item[i]|e }}</td>
                                                                            </tr>
                                                                        {% endfor %}
                                                                    {% endif %}
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>

                                                        <div class="inv--total-amounts">

                                                            <div class="row mt-4">
                                                                <div class="col-sm-5 col-12 order-sm-0 order-1">
                                                                </div>
                                                                <div class="col-sm-7 col-12 order-sm-1 order-0">
                                                                    <div class="text-sm-end">
                                                                        <div class="row">
                                                                            <div class="col-sm-8 col-7">
                                                                                <p class="">Sub Total :</p>
                                                                            </div>
                                                                            <div class="col-sm-4 col-5">
                                                                                <p class="">${{ invoiceInfo[0].subtotal }}</p>
                                                                            </div>
                                                                            <div class="col-sm-8 col-7">
                                                                                <p class=" discount-rate">Discount {% if invoiceInfo[0].discount_type == "Percent"  %}{{ invoiceInfo[0].discount_amount }}%    {% endif %}:</p>
                                                                            </div>
                                                                            <div class="col-sm-4 col-5">
                                                                                <p class="">${{ invoiceInfo[0].discount_amount_total }}</p>
                                                                            </div>
                                                                            <div class="col-sm-8 col-7 grand-total-title mt-3">
                                                                                <h4 style="color: #515365;">Grand Total : </h4>
                                                                            </div>
                                                                            <div class="col-sm-4 col-5 grand-total-amount mt-3">
                                                                                <h4 style="color: #515365;">${{ invoiceInfo[0].final_total }}</h4>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                        </div>

                                                        <div class="inv--note">

                                                            <div class="row mt-4">
                                                                <div class="col-sm-12 col-12 order-sm-0 order-1">
                                                                    <p >Note:{{ invoiceInfo[0].invoice_detail_notes }}</p>
                                                                </div>
                                                            </div>

                                                        </div>

                                                    </div>
                                                </div>

                                            </div>


                                        </div>

                                    </div>

                                </div>

                                <div class="col-xl-3">

                                    <div class="invoice-actions-btn">

                                        <div class="invoice-action-btn">

                                            <div class="row">
                                                <div class="col-xl-12 col-md-3 col-sm-6">
                                                    <a href="javascript:void(0);" class="btn btn-secondary btn-print  action-print">Print</a>
                                                </div>
                                                <div class="col-xl-12 col-md-3 col-sm-6">
                                                    <button type="button" class="btn btn-success btn-download w-100" style="margin-bottom: 20px;" id="download">Download</button>
                                                </div>
                                                <div class="col-xl-12 col-md-3 col-sm-6">
                                                    <a href="/user/invoice/update/{{ invoiceInfo[0].id }}" class="btn btn-dark btn-edit">Update</a>
                                                </div>
                                            </div>

                                        </div>

                                    </div>

                                </div>

                            </div>

                        </div>

                    </div>
                </div>

            </div>

        </div>
        <!--  BEGIN FOOTER  -->
        <div class="footer-wrapper">
            <div class="footer-wrapper">
                <div class="footer-section f-section-1">
                    <p class="">Copyright © <span class="dynamic-year">2024</span> <a target="_blank" href="https://zotecsoft.com/">ZotecSoft</a>, All rights reserved.</p>
                </div>
            </div>
        </div>
        <!--  END FOOTER  -->
    </div>
    <!--  END CONTENT AREA  -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>
    <script>
        window.onload = function () {
            document.getElementById("download")
                .addEventListener("click", () => {
                    const invoice = this.document.getElementById("printableArea");
                    let x = "Invoice";

                    var opt = {
                        margin: 0,
                        filename: x + '.pdf',
                        image: {
                            type: 'jpeg',
                            quality: 0.98
                        },
                        html2canvas: {
                            dpi: 192,
                            letterRendering: true
                        },
                        jsPDF: {
                            unit: 'in',
                            format: 'a4', // Change format to 'a4' or any other desired format
                            orientation: 'landscape', // Change orientation to 'landscape' for wider width
                        }
                    };
                    html2pdf().from(printableArea).set(opt).save();
                })
        }
    </script>
{% endblock %}