{% extends 'user/master.twig' %}
{% block content %}
    <div id="content" class="main-content">
        <div class="layout-px-spacing">
            <div class="middle-content container-xxl p-0">
                <div id="call-ringing"></div>

                <div class="account-settings-container layout-top-spacing">
                    <div class="content-body">
                        <div class="container-fluid">
                            <!-- row -->
                            <div class="row">
                                <div class="col-xl-12 col-lg-12">
                                    <div class="card card-bx m-b30">
                                        <div class="card-header">
                                            <h6 class="title">Questions</h6>
                                        </div>

                                        <form method="post" class="profile-form" id="editUserForm">
                                            <input type="hidden" name="csrf" value="{{ csrf }}">

                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-lg-12 mb-3">
                                                        <label class="form-label">Section Title</label>
                                                        <input type="text" class="form-control form-control-md" name="section_title" placeholder="Section Title" required>
                                                    </div>
                                                    <div class="col-lg-12 mb-3" id="questions_container">
                                                        <button class="btn btn-success" type="button" onclick="addQuestion();" style="background: #28a745 !important; border-color: #28a745 !important;">Add Question</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="card-footer">
                                                <button type="button" class="btn btn-primary" id="btn" onclick="add_questions()">Submit</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--  BEGIN FOOTER  -->
        <div class="footer-wrapper">
            <div class="footer-section f-section-1">
                <p class="">Copyright Â© <span class="dynamic-year">2024</span> <a target="_blank" href="https://zotecsoft.com/">ZotecSoft</a>, All rights reserved.</p>
            </div>
        </div>
        <!--  END FOOTER  -->
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        let questionCount = 0;

        function addQuestion() {
            questionCount++;
            const container = document.getElementById('questions_container');
            const questionDiv = document.createElement('div');
            questionDiv.classList.add('question-block', 'mb-3', 'p-3', 'border');
            questionDiv.innerHTML = `
                <div class="row">
                    <div class="col-sm-6 mb-3">
                        <label class="form-label">Question</label>
                        <input type="text" class="form-control form-control-md" name="questions[${questionCount}][question]" placeholder="Question" required>
                    </div>
                    <div class="col-sm-6 mb-3">
                        <label class="form-label">Type</label>
                        <select class="form-select form-select-md" name="questions[${questionCount}][type]" onchange="toggleOptionsField(this, ${questionCount})" required>
                            <option value="">Choose Your Input Type</option>
                            <option value="text">Text</option>
                            <option value="email">Email</option>
                            <option value="radio">Radio</option>
                            <option value="checkbox">Checkbox</option>
                            <option value="date">Date</option>
                            <option value="time">Time</option>
                            <option value="password">Password</option>
                            <option value="number">Number</option>
                            <option value="datetime-local">Datetime-local</option>
                            <option value="textarea">Textarea</option>
                            <option value="select">Select</option>
                            <option value="file">File</option>
                            <option value="signature">Signature</option>
                            <option value="none">None</option>
                        </select>
                    </div>

                    <div class="col-12 mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="questions[${questionCount}][required]" id="question-required-${questionCount}">
                            <label class="form-check-label" for="question-required-${questionCount}">
                                Required
                            </label>
                        </div>
                    </div>

                    <div class="col-12 additional-options" id="additional-options-${questionCount}" style="display: none;">
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label for="options" class="form-label">Options</label>
                                <div id="options-container-${questionCount}">
                                    <input type="text" class="form-control form-control-md mb-2" name="questions[${questionCount}][options][]" placeholder="Option">
                                </div>
                                <button class="btn btn-success" type="button" onclick="addOption(${questionCount});" style="background: #28a745 !important; border-color: #28a745 !important;">Add Option</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 text-right">
                        <button class="btn btn-danger" type="button" onclick="removeQuestion(this);" style="background: #dc3545 !important; border-color: #dc3545 !important;">Remove Question</button>
                    </div>
                </div>
            `;
            container.insertBefore(questionDiv, container.children[container.children.length - 1]);
        }



        function toggleOptionsField(selectElement, questionIndex) {
            const additionalOptions = document.getElementById(`additional-options-${questionIndex}`);
            if (['radio', 'checkbox', 'select'].includes(selectElement.value)) {
                additionalOptions.style.display = 'block';
            } else {
                additionalOptions.style.display = 'none';
            }
        }

        function addOption(questionIndex) {
            const container = document.getElementById(`options-container-${questionIndex}`);
            const input = document.createElement('input');
            input.type = 'text';
            input.name = `questions[${questionIndex}][options][]`;
            input.classList.add('form-control', 'form-control-md', 'mb-2');
            input.placeholder = 'Option';
            container.appendChild(input);
        }

        function removeQuestion(button) {
            const questionBlock = button.closest('.question-block');
            questionBlock.remove();
        }

        function add_questions() {
            document.getElementById('btn').disabled = true;
            var formData = new FormData(document.getElementById("editUserForm"));
            $.ajax({
                url: "/user/interviews/questions",
                type: "POST",
                data: formData,
                contentType: false,
                cache: false,
                processData: false,
                success: function (dataResult) {
                    console.log(dataResult);
                    if (dataResult == 1) {
                        document.getElementById('btn').disabled = false;
                        toastr.success('Added Successfully.');
                        document.getElementById("editUserForm").reset();
                    } else {
                        toastr.error('Something Went Wrong.');
                        document.getElementById('btn').disabled = false;
                    }
                }
            });
        }
    </script>
{% endblock %}
